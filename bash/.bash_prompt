#! /usr/bin/env bash

color_reset="\[\e[0m\]"
color_blue="\[\e[34m\]"
color_green="\[\e[32m\]"
color_grey="\[\e[90m\]"
color_yellow="\[\e[1;33m\]"
color_ltblue="\[\e[36m\]"

git_prompt_prefix="${color_yellow}git${color_green}"

git_prompt() {
  workdir="$(pwd)"
  if git rev-parse 2>/dev/null; then
    gitroot="$(git rev-parse --show-toplevel)"
    repo="$(basename $gitroot)"

    if [[ `basename $workdir` == "$repo" ]]; then
      # in the repo root
      printf "$git_prompt_prefix $repo"
    else
      # check if we're symlinked out of the git repo
      if [[ $workdir == $gitroot* ]]; then
        printf "$git_prompt_prefix $repo/$(git ls-tree --full-name --name-only HEAD $workdir)"
      else
        # in a symlink outside the repo, ignore git
        printf "${workdir/$HOME/~}"
      fi 
    fi
  else
    # not in a git repo
    printf "${workdir/$HOME/~}"
  fi
}

PROMPT_COMMAND='PS1="$color_blue\u$color_ltblue@$color_blue\h:$color_green$(git_prompt) $color_grey\$ $color_reset"'
